{"ast":null,"code":"var _jsxFileName = \"C:\\\\xampp\\\\htdocs\\\\DeliveryApp\\\\src\\\\pages\\\\OrderTracking.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { MapContainer, TileLayer, Marker, Popup } from 'react-leaflet';\nimport { io } from 'socket.io-client';\nimport L from 'leaflet';\nimport axios from 'axios';\nimport 'leaflet/dist/leaflet.css';\nimport ChatBox from './ChatBox'; // âœ… Make sure the path is correct\nimport { toast, ToastContainer } from 'react-toastify';\nimport 'react-toastify/dist/ReactToastify.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst notificationSound = new Audio('/notification.mp3'); // ðŸ”Š already placed in public/\n\n// Fix Leaflet icons\nL.Icon.Default.mergeOptions({\n  iconRetinaUrl: require('leaflet/dist/images/marker-icon-2x.png'),\n  iconUrl: require('leaflet/dist/images/marker-icon.png'),\n  shadowUrl: require('leaflet/dist/images/marker-shadow.png')\n});\nconst SOCKET_SERVER_URL = 'http://localhost:3001';\nconst OrderTracking = () => {\n  _s();\n  const {\n    orderId\n  } = useParams();\n  const navigate = useNavigate();\n  const [order, setOrder] = useState(null);\n  const [driverLocation, setDriverLocation] = useState(null);\n  const socketRef = useRef(null);\n  const driverId = localStorage.getItem('driverId');\n  const handleMarkDelivered = async () => {\n    try {\n      await axios.put(`http://localhost:3001/orders/mark-delivered/${orderId}`);\n      alert('Order marked as delivered!');\n      navigate('/driver-dashboard');\n    } catch (err) {\n      console.error('Failed to mark delivered:', err);\n    }\n  };\n  useEffect(() => {\n    axios.get(`http://localhost:3001/orders/${orderId}`).then(res => setOrder(res.data)).catch(() => console.error('Order fetch failed'));\n  }, [orderId]);\n  useEffect(() => {\n    const socket = io(SOCKET_SERVER_URL);\n    socketRef.current = socket;\n    socket.on('connect', () => {\n      console.log('âœ… Connected to socket');\n      socket.emit('joinRoom', {\n        orderId\n      }); // âœ… Safe to emit now\n    });\n    socket.on('orderAccepted', data => {\n      if (data.orderId === orderId) {\n        toast.info('ðŸšš Driver accepted your order! Tracking started.', {\n          position: 'top-right',\n          autoClose: 5000,\n          pauseOnHover: true,\n          draggable: true\n        });\n        notificationSound.play();\n      }\n    });\n    socket.on(`orderLocationUpdate:${orderId}`, data => {\n      setDriverLocation([data.lat, data.lng]);\n    });\n    if (driverId) {\n      const watchId = navigator.geolocation.watchPosition(({\n        coords\n      }) => {\n        if (socket.connected) {\n          socket.emit('driverLocation', {\n            orderId,\n            lat: coords.latitude,\n            lng: coords.longitude\n          });\n        }\n      }, err => console.error(err), {\n        enableHighAccuracy: true,\n        timeout: 5000,\n        maximumAge: 3000\n      });\n      return () => {\n        navigator.geolocation.clearWatch(watchId);\n        socket.disconnect();\n      };\n    }\n    return () => socket.disconnect();\n  }, [orderId, driverId]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: styles.container,\n    children: [/*#__PURE__*/_jsxDEV(MapContainer, {\n      center: [33.89, 35.5],\n      zoom: 13,\n      style: styles.map,\n      children: [/*#__PURE__*/_jsxDEV(TileLayer, {\n        url: \"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 99,\n        columnNumber: 9\n      }, this), driverLocation && /*#__PURE__*/_jsxDEV(Marker, {\n        position: driverLocation,\n        children: /*#__PURE__*/_jsxDEV(Popup, {\n          children: \"Driver is here!\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 102,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 7\n    }, this), driverId && /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: handleMarkDelivered,\n      style: styles.deliverButton,\n      children: \"Mark as Delivered\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(ChatBox, {\n      orderId: orderId,\n      userType: driverId ? 'driver' : 'customer'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ToastContainer, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 97,\n    columnNumber: 5\n  }, this);\n};\n_s(OrderTracking, \"qiJUkrRbhirTsSGgSz1VKZbhTnk=\", false, function () {\n  return [useParams, useNavigate];\n});\n_c = OrderTracking;\nconst styles = {\n  container: {\n    minHeight: '100vh',\n    backgroundColor: '#f0f2f5',\n    fontFamily: 'Arial, sans-serif',\n    padding: '20px'\n  },\n  map: {\n    height: '400px',\n    width: '100%',\n    borderRadius: '5px',\n    marginBottom: '20px'\n  },\n  deliverButton: {\n    padding: '12px 20px',\n    backgroundColor: '#4CAF50',\n    color: 'white',\n    border: 'none',\n    borderRadius: '8px',\n    cursor: 'pointer',\n    fontSize: '16px',\n    marginBottom: '20px'\n  }\n};\nexport default OrderTracking;\nvar _c;\n$RefreshReg$(_c, \"OrderTracking\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useParams","useNavigate","MapContainer","TileLayer","Marker","Popup","io","L","axios","ChatBox","toast","ToastContainer","jsxDEV","_jsxDEV","notificationSound","Audio","Icon","Default","mergeOptions","iconRetinaUrl","require","iconUrl","shadowUrl","SOCKET_SERVER_URL","OrderTracking","_s","orderId","navigate","order","setOrder","driverLocation","setDriverLocation","socketRef","driverId","localStorage","getItem","handleMarkDelivered","put","alert","err","console","error","get","then","res","data","catch","socket","current","on","log","emit","info","position","autoClose","pauseOnHover","draggable","play","lat","lng","watchId","navigator","geolocation","watchPosition","coords","connected","latitude","longitude","enableHighAccuracy","timeout","maximumAge","clearWatch","disconnect","style","styles","container","children","center","zoom","map","url","fileName","_jsxFileName","lineNumber","columnNumber","onClick","deliverButton","userType","_c","minHeight","backgroundColor","fontFamily","padding","height","width","borderRadius","marginBottom","color","border","cursor","fontSize","$RefreshReg$"],"sources":["C:/xampp/htdocs/DeliveryApp/src/pages/OrderTracking.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport { MapContainer, TileLayer, Marker, Popup } from 'react-leaflet';\r\nimport { io } from 'socket.io-client';\r\nimport L from 'leaflet';\r\nimport axios from 'axios';\r\nimport 'leaflet/dist/leaflet.css';\r\nimport ChatBox from './ChatBox'; // âœ… Make sure the path is correct\r\nimport { toast, ToastContainer } from 'react-toastify';\r\nimport 'react-toastify/dist/ReactToastify.css';\r\n\r\nconst notificationSound = new Audio('/notification.mp3'); // ðŸ”Š already placed in public/\r\n\r\n// Fix Leaflet icons\r\nL.Icon.Default.mergeOptions({\r\n  iconRetinaUrl: require('leaflet/dist/images/marker-icon-2x.png'),\r\n  iconUrl: require('leaflet/dist/images/marker-icon.png'),\r\n  shadowUrl: require('leaflet/dist/images/marker-shadow.png'),\r\n});\r\n\r\nconst SOCKET_SERVER_URL = 'http://localhost:3001';\r\n\r\nconst OrderTracking = () => {\r\n  const { orderId } = useParams();\r\n  const navigate = useNavigate();\r\n  const [order, setOrder] = useState(null);\r\n  const [driverLocation, setDriverLocation] = useState(null);\r\n  const socketRef = useRef(null);\r\n  const driverId = localStorage.getItem('driverId');\r\n\r\n  const handleMarkDelivered = async () => {\r\n    try {\r\n      await axios.put(`http://localhost:3001/orders/mark-delivered/${orderId}`);\r\n      alert('Order marked as delivered!');\r\n      navigate('/driver-dashboard');\r\n    } catch (err) {\r\n      console.error('Failed to mark delivered:', err);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    axios.get(`http://localhost:3001/orders/${orderId}`)\r\n      .then(res => setOrder(res.data))\r\n      .catch(() => console.error('Order fetch failed'));\r\n  }, [orderId]);\r\n\r\n  useEffect(() => {\r\n    const socket = io(SOCKET_SERVER_URL);\r\n    socketRef.current = socket;\r\n  \r\n    socket.on('connect', () => {\r\n      console.log('âœ… Connected to socket');\r\n      socket.emit('joinRoom', { orderId }); // âœ… Safe to emit now\r\n    });\r\n  \r\n    socket.on('orderAccepted', (data) => {\r\n      if (data.orderId === orderId) {\r\n        toast.info('ðŸšš Driver accepted your order! Tracking started.', {\r\n          position: 'top-right',\r\n          autoClose: 5000,\r\n          pauseOnHover: true,\r\n          draggable: true\r\n        });\r\n        notificationSound.play();\r\n      }\r\n    });\r\n  \r\n    socket.on(`orderLocationUpdate:${orderId}`, (data) => {\r\n      setDriverLocation([data.lat, data.lng]);\r\n    });\r\n  \r\n    if (driverId) {\r\n      const watchId = navigator.geolocation.watchPosition(\r\n        ({ coords }) => {\r\n          if (socket.connected) {\r\n            socket.emit('driverLocation', {\r\n              orderId,\r\n              lat: coords.latitude,\r\n              lng: coords.longitude\r\n            });\r\n          }\r\n        },\r\n        err => console.error(err),\r\n        { enableHighAccuracy: true, timeout: 5000, maximumAge: 3000 }\r\n      );\r\n  \r\n      return () => {\r\n        navigator.geolocation.clearWatch(watchId);\r\n        socket.disconnect();\r\n      };\r\n    }\r\n  \r\n    return () => socket.disconnect();\r\n  }, [orderId, driverId]);  \r\n\r\n  return (\r\n    <div style={styles.container}>\r\n      <MapContainer center={[33.89, 35.5]} zoom={13} style={styles.map}>\r\n        <TileLayer url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\" />\r\n        {driverLocation && (\r\n          <Marker position={driverLocation}>\r\n            <Popup>Driver is here!</Popup>\r\n          </Marker>\r\n        )}\r\n      </MapContainer>\r\n\r\n      {driverId && (\r\n        <button onClick={handleMarkDelivered} style={styles.deliverButton}>\r\n          Mark as Delivered\r\n        </button>\r\n      )}\r\n\r\n      {/* âœ… Chat for driver & customer */}\r\n      <ChatBox orderId={orderId} userType={driverId ? 'driver' : 'customer'} />\r\n      <ToastContainer />\r\n    </div>\r\n  );\r\n};\r\n\r\nconst styles = {\r\n  container: {\r\n    minHeight: '100vh',\r\n    backgroundColor: '#f0f2f5',\r\n    fontFamily: 'Arial, sans-serif',\r\n    padding: '20px'\r\n  },\r\n  map: {\r\n    height: '400px',\r\n    width: '100%',\r\n    borderRadius: '5px',\r\n    marginBottom: '20px'\r\n  },\r\n  deliverButton: {\r\n    padding: '12px 20px',\r\n    backgroundColor: '#4CAF50',\r\n    color: 'white',\r\n    border: 'none',\r\n    borderRadius: '8px',\r\n    cursor: 'pointer',\r\n    fontSize: '16px',\r\n    marginBottom: '20px'\r\n  }\r\n};\r\n\r\nexport default OrderTracking;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}